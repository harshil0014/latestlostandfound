<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>My Claims</title>
  <style>
    body{font-family:sans-serif;padding:20px;}
    table {
      width:100%;
      border-collapse:collapse;
     
    }
    th,td{
      padding:8px;
      border:1px solid #ccc;
      word-wrap:break-word;      /* ‚Üê force breaks */
    }
    /* Only complaints table gets fixed layout + colgroup */
    table.complaints {
      table-layout: fixed;
    }

  </style>

</head>
<body>
  <h1>My Claim Requests</h1>
  <table>
    <thead>
      <tr>
        <th>Item #</th>
        <th>Status</th>
        <th>On</th>
        <th>QR</th>
        <th>Upload Proof</th>
      </tr>
    </thead>
    <tbody>
    {% for c in my_requests %}
      <tr>
        <!-- 1: Item -->
        <td>{{ c.report_id }}</td>

        <!-- 2: Status -->
        <td>{{ c.status.title() }}</td>

        <!-- 3: Date -->
        <td>{{ c.timestamp.strftime('%Y-%m-%d') }}</td>

        <!-- 4: QR code -->
        <td>
          {% if c.report.qr_code %}
            <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 8px;">

              <!-- View QR -->
              <a href="{{ url_for('static', filename=c.report.qr_code) }}" target="_blank"
                title="Scan this on mobile to verify claim"
                style="font-weight: bold; color: #2980b9; text-decoration: none;">
                üîç View QR Code
              </a>

              <!-- Download QR -->
              <a href="{{ url_for('static', filename=c.report.qr_code) }}" download
                style="background: #2ecc71; color: white; padding: 6px 12px; border-radius: 4px;
                        text-decoration: none; font-size: 0.9em;">
                ‚¨áÔ∏è Download QR
              </a>
              <!-- Print QR -->
              <button onclick="printQR('{{ url_for('static', filename=c.report.qr_code) }}')"
                      style="background: #3498db; color: white; padding: 6px 12px;
                            border: none; border-radius: 4px; font-size: 0.9em; cursor: pointer;">
                üñ®Ô∏è Print QR
              </button>
              
            </div>
          {% else %}
            <span style="color: #aaa;">‚Äì</span>
          {% endif %}
        </td>


        <!-- 5: Proof upload (only when required) -->
        <td>
          {% if c.status.lower() == 'requires proof' %}
            <form action="{{ url_for('upload_proof', claim_id=c.id) }}"
                  method="POST" enctype="multipart/form-data">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              
              <select name="proof_type" required>
                <option value="">‚ÄìSelect‚Äì</option>
                <option value="receipt">Receipt</option>
                <option value="image">Image</option>
              </select>
              
              <input type="file" name="proof_file" accept="image/*,application/pdf" required>
              <button type="submit">Upload</button>
            </form>
          {% else %}
            ‚Äì
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  
  <h2>My Complaints</h2>
  <table class="complaints">
    <colgroup>
      <col style="width: 80px;">
      <col style="width: 300px;">
      <col style="width: 100px;">
      <col style="width: 120px;">
    </colgroup>
    <thead>
      <tr>
        <th>Item #</th>
        <th>Details</th>
        <th>Status</th>
        <th>Submitted On</th>
      </tr>
    </thead>
    <tbody>
      {% for comp in complaints %}
      <tr>
        <td>{{ comp.report_id }}</td>
        <td>{{ comp.details }}</td>

        <td>{{ comp.status|default('Pending')|title }}</td>
        <td>{{ comp.created_at.strftime('%Y-%m-%d') }}</td>
      </tr>
      {% else %}
      <tr>
        <td colspan="4">You have not filed any complaints.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>


  <p><a href="{{ url_for('show_home') }}">&larr; Back</a></p>
  <script>
  function printQR(imageUrl) {
    const w = window.open();
    w.document.write(`
      <html>
        <head><title>Print QR</title></head>
        <body style="text-align:center;padding:40px;font-family:sans-serif;">
          <h2 style="color:#2c3e50;">Scan this QR Code</h2>
          <img src="${imageUrl}" style="width:300px; border: 1px solid #ccc; padding: 10px;"/>
          <br><br>
          <button onclick="window.print()" style="padding:10px 20px;font-size:16px; background: #3498db; color: white; border: none; border-radius: 6px;">
            üñ®Ô∏è Print
          </button>
        </body>
      </html>
    `);
    w.document.close();
  }
  </script>
  <!-- Floating Help Button -->
  <button id="helpBtn"
    style="position:fixed; top:20px; right:20px; z-index:1000;
          background:#3498db; color:#fff; border:none; border-radius:50%;
          width:40px; height:40px; font-size:20px; cursor:pointer;"
    title="Help using this page">
    ?
  </button>

  <!-- Help Modal -->
  <div id="helpModal" style="display:none; position:fixed; top:0; left:0;
      width:100%; height:100%; background:rgba(0,0,0,0.5);
      justify-content:center; align-items:center; z-index:1001;">
    <div style="background:#fff; padding:20px; border-radius:8px;
                max-width:500px; width:90%; position:relative;">
      <button onclick="document.getElementById('helpModal').style.display='none'"
              style="position:absolute; top:8px; right:12px; font-size:18px; background:none; border:none; cursor:pointer;">
        ‚úñ
      </button>
      <h3 style="margin-top:0;">üîç Help: {{ help_title }}</h3>
      <p style="margin-top:10px; white-space:pre-wrap;">{{ help_text }}</p>
    </div>
  </div>

  <script>
    document.getElementById("helpBtn").onclick = function() {
      document.getElementById("helpModal").style.display = "flex";
    };
  </script>
</body>
</html>
